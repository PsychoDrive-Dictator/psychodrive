<head>
  <title>PsychoDrive Test Results</title>
  <script src="current_results.json"></script>
  <script src="new_results.json"></script>
  <script type="text/javascript">
    function formatError(error) {
      if (error.count == 0) return '0';
      return error.count + ' (' + error.firstFrame + '-' + error.lastFrame + ')';
    }
    function fillResultsTable() {
      for (var i = 0; i < newResults.length; i++) {
        const newResult = newResults[i];
        curMatchingResult = null;
        for (var j = 0; j < currentResults.length; j++) {
          if (currentResults[j].testName == newResult.testName) {
            curMatchingResult = currentResults[j];
          }
        }

        const tbodyRef = document.getElementById('resultsTable').getElementsByTagName('tbody')[0];
        const curResultRow = tbodyRef.insertRow();
        const newResultRow = tbodyRef.insertRow();

        testNameCell = curResultRow.insertCell();
        testNameCell.rowSpan = 2;
        nameText = document.createTextNode(newResult.testName);
        testNameCell.appendChild(nameText);

        testNameCell = curResultRow.insertCell();
        testNameCell.rowSpan = 2;
        nameText = document.createTextNode(newResult.testVersion);
        testNameCell.appendChild(nameText);

        for (var error = 0; error < newResult.errorTypes.length; error++) {
          curCell = curResultRow.insertCell();
          curTextContent = curMatchingResult ? formatError(curMatchingResult.errorTypes[error]) : "-";
          text = document.createTextNode(curTextContent);
          curCell.appendChild(text);

          newCell = newResultRow.insertCell();
          newTextContent = formatError(newResult.errorTypes[error]);
          text = document.createTextNode(newTextContent);
          newCell.appendChild(text);

          if (curTextContent == newTextContent) {
            if (curTextContent == '0') {
              curCell.classList.add("complete");
              curCell.removeChild(curCell.lastChild);
            }
            curCell.rowSpan = 2;

            newCell.parentNode.removeChild(newCell);
          }
        }
      }
    }

  </script>
  <style>
    body {
      background-color: rgb(51, 51, 51);
    }
    table, td, th {
      color:rgb(255, 255, 255);
      border: 1px solid white;
      border-collapse: collapse;
      padding: 5px;
    }

    .complete {
      background-color: rgb(0, 60, 40);
    }
  </style>
</head>
<body onload="fillResultsTable();">
  <div>
    <table id="resultsTable">
      <thead>
        <tr>
          <th scope="col">Test</th>
          <th scope="col">CharVersion</th>
          <th scope="col">Pos</th>
          <th scope="col">Vel</th>
          <th scope="col">Accel</th>
          <th scope="col">HitVel</th>
          <th scope="col">HitAccel</th>
          <th scope="col">ActionID</th>
          <th scope="col">ActionFrame</th>
        </tr>
      </thead>
      <tbody>

      </tbody>
    </table>
  </div>
</body>

